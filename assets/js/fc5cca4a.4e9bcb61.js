"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[1267],{2229:(e,i,o)=>{o.r(i),o.d(i,{assets:()=>s,contentTitle:()=>a,default:()=>h,frontMatter:()=>n,metadata:()=>c,toc:()=>l});var r=o(4848),t=o(8453);o(6025);const n={sidebar_position:6},a="IAccumulator",c={id:"documentation-core/behaviors/accumulators",title:"IAccumulator",description:"Two custom jobs which can simplify creating behaviors use implementations of IAccumulator. Types implementing this interface must be included as generic parameters for implementations of INeighborBehaviorJob and IRaycastBehaviorJob.",source:"@site/docs/4_documentation-core/6_behaviors/3_accumulators.mdx",sourceDirName:"4_documentation-core/6_behaviors",slug:"/documentation-core/behaviors/accumulators",permalink:"/Steering-AI-Documentation/docs/documentation-core/behaviors/accumulators",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"IRaycastBehaviorJobWrapper",permalink:"/Steering-AI-Documentation/docs/documentation-core/behaviors/ray-behaviors/ray-behaviors"},next:{title:"Combiner",permalink:"/Steering-AI-Documentation/docs/documentation-core/combiner"}},s={},l=[{value:"Overview",id:"overview",level:2},{value:"Example",id:"example",level:2}];function u(e){const i={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"iaccumulator",children:"IAccumulator"})}),"\n",(0,r.jsxs)(i.p,{children:["Two ",(0,r.jsx)(i.a,{href:"https://docs.unity3d.com/Packages/com.unity.jobs@0.0/manual/custom_job_types.html",children:"custom jobs"})," which can simplify creating behaviors use implementations of ",(0,r.jsx)(i.code,{children:"IAccumulator"}),". Types implementing this interface must be included as generic parameters for implementations of ",(0,r.jsx)(i.a,{href:"/docs/documentation-core/behaviors/neighbor-behaviors/#implementing-ineighborbehaviorjobc1-c2-a-r",children:(0,r.jsx)(i.code,{children:"INeighborBehaviorJob<C1, C2, A, R>"})})," and ",(0,r.jsx)(i.a,{href:"/docs/documentation-core/behaviors/ray-behaviors/ray-behaviors#implementing-iraycastbehaviorjobc-a1-a2-r",children:(0,r.jsx)(i.code,{children:"IRaycastBehaviorJob<C, A1, A2, R>"})}),"."]}),"\n",(0,r.jsx)(i.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(i.p,{children:["Their purpose is to accumulate sub-results per entity which can be turned into a ",(0,r.jsx)(i.a,{href:"/docs/documentation-defaults/behaviors/VelocityResult",children:(0,r.jsx)(i.code,{children:"VelocityResult"})})," afterwards. For example in the case of ",(0,r.jsx)(i.a,{href:"/docs/documentation-core/behaviors/neighbor-behaviors/#implementing-ineighborbehaviorjobc1-c2-a-r",children:(0,r.jsx)(i.code,{children:"INeighborBehaviorJob<C1, C2, A, R>"})}),", it's ",(0,r.jsx)(i.code,{children:"Execute"})," method is called once per each entity neighbor pair. Accumulators keep track of some state between the call per entity. The following is pseudo code of how accumulators are used internally."]}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-csharp",metastring:'title="pseudo code illustrating how accumulators are used"',children:"foreach entity in entities:\r\n    accumulator = new().Init()\r\n    foreach neighbor in entity.neighbors:\r\n        job.Execute(entity, neighbor, accumulator)\r\n    job.Finalize(entity, accumulator)\n"})}),"\n",(0,r.jsx)(i.h2,{id:"example",children:"Example"}),"\n",(0,r.jsxs)(i.p,{children:["For example to create a ",(0,r.jsx)(i.a,{href:"/docs/documentation-defaults/behaviors/neighbor-behaviors/cohesion",children:"cohesion behavior"}),", a ",(0,r.jsx)(i.a,{href:"https://en.wikipedia.org/wiki/Centroid",children:"centroid"})," (average position) of all neighbors is calculated first. This could be implemented with the following implementation of ",(0,r.jsx)(i.code,{children:"IAccumulator"})," and ",(0,r.jsx)(i.code,{children:"INeighborBehaviorJob<C1, C2, SimpleAccumulator, VelocityResult>"}),"."]}),"\n",(0,r.jsx)(i.admonition,{type:"note",children:(0,r.jsxs)(i.p,{children:["The ",(0,r.jsx)(i.a,{href:"/docs/documentation-defaults/behaviors/neighbor-behaviors/cohesion",children:"implementation"})," in the ",(0,r.jsx)(i.a,{href:"/docs/category/documentation-defaults",children:"defaults library"})," actually uses ",(0,r.jsx)(i.a,{href:"https://en.wikipedia.org/wiki/Weighted_arithmetic_mean",children:"weighted average"})," of positions. For the sake of simplicity, average of positions (",(0,r.jsx)(i.a,{href:"https://en.wikipedia.org/wiki/Centroid",children:"centroid"}),") is used in the following example."]})}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-csharp",metastring:'title="calculating a centroid"',children:"public struct CentroidAccumulator : IAccumulator\r\n{\r\n    public float3 SumPosition;\r\n    public int NumNeighbors;\r\n\r\n    public void Add(float3 position)\r\n    {\r\n        SumPosition += position;\r\n        NumNeighbors++;\r\n    }\r\n\r\n    public void Init()\r\n    {\r\n        SumPosition = new float3();\r\n        NumNeighbors = 0;\r\n    }\r\n\r\n    public float3 CalculateCentroid()\r\n    {\r\n        return SumPosition / NumNeighbors;\r\n    }\r\n}\r\n\r\nstruct CohesionJob : INeighborBehaviorJob<C1, C2, SimpleAccumulator, VelocityResult>\r\n{\r\n    public void Execute(in NeighborBehaviorData<C1, C2> behaviorData, ref CentroidAccumulator accumulator)\r\n    {\r\n        // pass in position of the neighbor\r\n        accumulator.Add(behaviorData.OtherEntity.Position);\r\n    }\r\n    \r\n    public VelocityResult Finalize(in EntityInformation<C1> entity, in CentroidAccumulator accumulator)\r\n    {\r\n        float3 centroid = accumulator.CalculateCentroid();\r\n        float3 toCentroid = centroid - entity.Position \r\n        ... // rest of the behavior\r\n    }\r\n}\n"})})]})}function h(e={}){const{wrapper:i}={...(0,t.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},8453:(e,i,o)=>{o.d(i,{R:()=>a,x:()=>c});var r=o(6540);const t={},n=r.createContext(t);function a(e){const i=r.useContext(n);return r.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function c(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(n.Provider,{value:i},e.children)}}}]);